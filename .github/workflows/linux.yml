name: C/C++ CI Linux

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  native:
    runs-on: ubuntu-20.04
    strategy:
      matrix:
          target: [w65-snes-elf, w65-elf]
    steps:
    - name: Checkout
      uses: actions/checkout@v2.3.0
      with:
        submodules: true 
    - name: Install Toolchain
      run: sudo apt install gcc g++
    - name: Setup
      run: |
          mkdir -pv ${{runner.workspace}}/build
    - name: Configure
      working-directory: 
      run: |
        ${{runner.workspace}}/configure --prefix ${{runner.workspace}}/.ciprefix --target ${{matrix.target}}
  cross:
    runs-on: ubuntu-20.04
    strategy:
      matrix:
          target: [w65-snes-elf, w65-elf]
          host: [aarch64-linux-gnu, alpha-linux-gnu, arm-linux-gnueabi, i686-linux-gnu, mips-linux-gnu, mips64-linux-gnuabi64, m68k-linux-gnu]
    steps:
    - name: Checkout
      uses: actions/checkout@v2.3.0
      with:
        submodules: true 
    - name: Install Toolchain
      run: sudo apt install gcc g++ gcc-${{matrix.host}} g++-${{matrix.host}}
    - name: Setup
      run: |
          mkdir -pv ${{runner.workspace}}/build
    - name: Configure
      working-directory: 
      run: |
        ${{runner.workspace}}/configure --prefix ${{runner.workspace}}/.ciprefix --target ${{matrix.target}} --host ${{matrix.host}}
    